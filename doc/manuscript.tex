%---------------------------------------------
% This document is for pdflatex
%---------------------------------------------
\documentclass[11pt]{article}

\usepackage{amsmath,amsfonts,amssymb,graphicx,setspace,authblk}
\usepackage{float}
\usepackage[running]{lineno}
\usepackage[vmargin=1in,hmargin=1in]{geometry}
\usepackage[sc]{mathpazo} %Like Palatino with extensive math support

\usepackage[authoryear]{natbib}

\graphicspath{ {./../genetic-diversity/figures/} {./../community-turnover/figures/} }

\usepackage{enumitem}
\setlist{topsep=.125em,itemsep=-0.15em,leftmargin=0.75cm}

\usepackage{gensymb}

\usepackage[compact]{titlesec} 

\usepackage{bm,mathrsfs}

\usepackage{ifpdf}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{epstopdf}
\else
\DeclareGraphicsExtensions{.eps}
\fi

\renewcommand{\floatpagefraction}{0.98}
\renewcommand{\topfraction}{0.99}
\renewcommand{\textfraction}{0.05}

\clubpenalty = 10000
\widowpenalty = 10000

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%% Just for commenting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[usenames]{color}
\newcommand{\new}{\textcolor{red}}
\newcommand{\spe}{\textcolor{blue}}
\newcommand{\comment}{\textcolor{red}}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ba}{\begin{equation} \begin{aligned}}
\newcommand{\ea}{\end{aligned} \end{equation}}

\def\X{\mathbf{X}}

\floatstyle{boxed}
\newfloat{Box}{tbph}{box}

\title{\textbf{ Matching the forecast horizon with the relevant ecological processes }}

\author[1]{Peter B. Adler}  %\thanks{Corresponding author. Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah Email: peter.adler@usu.edu}}
\author[2]{Ethan P. White}
\author[3]{Michael H. Cortez}
\affil[1]{Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah}
\affil[2]{Department of Wildlife Ecology and Conservation, University of Florida, Gainesville, Florida}
\affil[3]{Department of Biological Science, Florida State University, Tallahasee, Florida}

\renewcommand\Authands{ and }

% \date{Last compile: \today} 

\sloppy

\renewcommand{\baselinestretch}{1.25}

\begin{document}

\maketitle

\linenumbers

\section*{Abstract}

Most models used to generate ecological forecasts take either a time-series approach, based on long-term data from one location, or a space-for-time approach, based on data describing spatial patterns across environmental gradients. Here we consider how the forecast horizon determines whether the most accurate predictions come from the time-series approach, the space-for-time approach, or a combination of the two. We use two simulation case studies to show that forecasts for short and long-time scales need to focus on different ecological processes, which are reflected in different kinds of data. In the short-term, dynamics reflect initial conditions and fast processes such as birth and death, and the phenomenological time-series approach makes the best predictions. In the long-term, dynamics reflect the additional influence of slower processes such as evolutionary and ecological selection, colonization and extinction, which the space-for-time approach can effectively capture. At intermediate time-scales, a weighted average of the two approaches shows promise. However, making this combined approach operational will require new research to predict the rate at which slow processes begin to influence dynamics.

\vspace{0.2in}

\textbf{\large{Keywords:}} dispersal, ecological forecasting, eco-evolutionary dynamics, global change, selection

\section*{Introduction}

Forecasting is increasingly recognized as important to the application and advancement of ecological research.
Forecasts are necessary to guide environmental policy and management
decisions about mitigation and adaption to global change \citep{clark_ecological_2001,mouquet_review:_2015,dietze_iterative_2018}.
But forecasts can also advance understanding of the processes governing ecological systems by providing rigorous tests of 
model predictions \citep{houlahan_priority_2017,dietze_prediction_2017,dietze_iterative_2018}.
The combined benefits of informing policy and management and advancing basic research 
makes forecasting an important priority for ecological research.

Most models used for ecological forecasting have traditionally been based on either time-series approaches or space-for-time substitutions. The time-series approach involves fitting models to long-term datasets to describe the temporal dynamics of a system.  We then use those dynamic models to make predictions about what will happen in the future. This approach is often used to study population or vital rate fluctuations as a function of weather \citep{dalgleish_climate_2011}, or primary production as a function of precipitation \citep{lauenroth_long-term_1992}. Whether process-based or data-driven (e.g., \citealt{ward_complexity_2014}), time-series models typically capture ``fast processes'' operating on interannual time-scales, such as birth, death, individual growth, small-scale dispersal events, and short-term responses to environmental conditions (Fig. \ref{fig:fast-slow-concept}). However, models built using this approach typically cover a limited spatial extent (but see \citealt{Hefley2017,kleinhesselink_response_2018}), and ignore slower processes, such as evolutionary adaptation or turnover in community composition, that could influence dynamics at longer time scales \citep{clark_ecological_2001}. 

Space-for-time substitution approaches begin by describing how an ecological variable of interest, such as occupancy or productivity,  varies across sites experiencing different environmental conditions. These spatial relationships between environment and ecological response are assumed to also hold for changes at a site through time. To make a forecast, we first predict the future environmental conditions and then determine the associated ecological response, based on the observed spatial relationship.  This is the approach commonly used to predict population distribution or abundance as a function of climate \citep{elith_species_2009} or primary production as a function of mean precipitation \citep{Sala1988}. Space-for-time models capture the outcome of interactions between fast processes and slower processes operating over long time periods, such as immigration, extinction, and responses to large or prolonged environmental changes (Fig. \ref{fig:fast-slow-concept}). However, space-for-time models provide no information about how quickly the system will move from the current state to the predicted, future state. In fact, transient dynamics could prevent the system from ever reaching the predicted steady state \citep{Urban2012}. Although both time-series and space-for-time approaches are widely used, there has been little discussion of their advantages and disadvantages for guiding policy decisions or advancing our understanding of ecological dynamics (\citealt{harris_forecasting_2018}, but see \citealt{Renwick2018}). 

Whether historical dynamics, contemporary spatial patterns, or some combination of the two will serve as the best source of 
information for forecasting may depend on how far into the future we are attempting to forecast \citep{harris_forecasting_2018}. 
This potential dependency on the ``forecast horizon'' (\textit{sensu} \citealt{Hyndman2018})
reflects lags in the response of ecological conditions to environmental change, shifts in the importance of ecological processes with
time scale \citep{levin_1992,rosenzweig_1995}, and differences between time-series and spatial gradients in the range of 
environmental conditions represented in observed data.
At short forecast horizons (days to years), dynamics will reflect the physiological and demographic responses of 
the organisms present at a site more than turnover of genotypes or species, 
environmental conditions are likely to stay within the range of historical variation, 
and the current state of the system is likely to capture the influence of unmeasured processes. As a result, 
for near-term forecasts time-series approaches may capture the key dynamics and provide accurate predictions.

\begin{figure}[tbp]
	\centering
	\includegraphics[width=0.5 \textwidth] {fast-slow-figure.png}
	\caption{Fast and slow processes operate at different time scales, and are reflected in different kinds of datasets. Fast processes, such as births, deaths, and individual growth, operate at all time scales, but are the exclusive drivers of the short-term dynamics captured in most time series datasets. Slower processes, such as evolutionary selection on genotype frequencies, ecological selection on species abundances, and colonization and extinction, interact with fast processes to drive dynamics over the long-term. The influence of these slow processes is seen in very long time series, or in spatial gradients. Spatiotemporal datasets with long enough records to capture changes in spatial patterns are rare, but would be extremely valuable for understanding dynamics at intermediate time scales. The time scales shown here were chosen with vascular plants in mind; the same concepts would apply for much shorter-lived organisms but at shorter time scales.   }
	\label{fig:fast-slow-concept}
\end{figure}

In contrast, at long forecast horizons (decades to centuries),  environmental conditions that have not been 
historically observed are likely to not only occur but to persist long enough to drive significant turnover of genotypes and species 
along with changes in the flux of energy and nutrients.  At these long scales, the current state of the system may be 
little help in predicting the future state. For the century-scale forecasts often featured in biodiversity and 
species-distribution modeling, space-for-time approaches may effectively capture the response of ecosystems to major shifts 
in climate over long periods, producing better long-term forecasts than time-series approaches. 
Using different modeling approaches for different forecast horizons is common in other disciplines.
For example, meteorological models for short-term weather forecasts differ substantially in spatial
and temporal resolution and extent from the global circulation models used to predict long-term changes
in climate.

Here we use simulation models to 1) demonstrate that the best model-building approaches for ecological forecasting 
depend on the time horizon of the forecast, and 2) explore how time-series and space-for-time approaches might be 
combined to make better forecasts at intermediate time scales. We conduct two simulation case studies, one 
focused on how interspecific interactions affect the population dynamics of a focal species, and the second focused on
an eco-evolutionary scenario. Our analyses show that: 
\begin{enumerate}
	\item For short-term forecasts, phenomenological time-series approaches are hard to beat, whereas longer-term forecasts require accounting for the influence of slow processes such as evolutionary and ecological selection as well as dispersal.
	\item Different kinds of data reflect the operation of different processes: longitudinal data capture autocorrelation and fast responses of current assemblages to interannual environmental variation, while data spanning spatial gradients capture the long-term outcome of interactions between fast and slow processes.  Whether predictive models should be trained using longitudinal or spatial data sets, or both, depends on the time-scale of the desired forecast.
	\item A key challenge for future research is determining the rate at which slow processes begin to influence dynamics.
\end{enumerate}

\section*{Modeling approach}

In two case studies, we simulated the effects of an increase in temperature on simple systems with known dynamics.
The ``truth'' is represented by a model that is mechanistic for at least one important process, but we treat the model as unknown when
analyzing the data and we assumed that perfectly recovering this model would not be possible in practice. We began each simulation
under stationary temperature, allowing the system to equilibrate; we call this the baseline phase. 
We then increased temperature progressively over a period of time, followed by a second period of stationary, now elevated, temperature. 
The objective was to forecast the response of the system to the temperature increase based on data gathered during the baseline period. 

We made forecasts based on two phenomenological models, each representing processes operating at different time scales. 
The first phenomenological model represents the space-for-time substiution approach, which we call the ``spatial approach'' for brevity. 
We correlated the mean environment with the mean of an ecological state or rate across many sites. The second model represents the time-series or ``temporal approach.'' We correlated interannual variation in an ecological response with interannual variation in the environment at just one site. We compared forecasts from both models to the simulated dynamics to determine how well the two approaches perform at different forecast horizons. We also assessed the potential for combining the information available in both spatial and temporal patterns by using a weighted average of the forecasts from the spatial and temporal approaches optimized to best match the (simulated) observations. We then studied how the optimal model weights changed over time. We expected the temporal model to best predict short-term dynamics, the spatial model to best predict long-term dynamics, and that a combination of the two approaches would provide the best forecasts at transitional, intermediate time scales. The spatial, temporal and combined statistical models are described in Appendix \ref{models} and all code for both case studies is available at Github (https://github.com/pbadler/space-time-forecast).

\subsection*{Community turnover example}

Conservation biologists and natural resource managers often need to anticipate the impact of environmental change on the abundance of 
endangered species, biological invaders, and harvested species. Although the managers may be primarily interested in just one focal species, skillful prediction might require considering interactions with many other species, greatly complicating the problem. But at what forecast horizon do altered species interactions become impossible to ignore? We explored this question using a metacommunity model developed by \cite{alexander_lags_2018}. The model describes Lotka-Volterra competitive interactions among plants within sites that are arrayed along an elevation and temperature gradient. Composition varies along the gradient because of a trade-off between growth rate and cold tolerance: cold sites are dominated by slow-growing species that can tolerate low temperatures, while warm sites are dominated by  fast-growing species that are cold intolerant. Multiple species can coexist within sites because all species experience stronger competition from conspecifics than from heterospecifics. Sites are linked by dispersal: a specified fraction of each species' offspring leaves the site where they were produced and reaches all other sites with equal probability. We provide a more detailed description of the model in Appendix \ref{metacomm}.

We first simulated a baseline period with variable but stationary temperature, followed by a period of rapid temperature increase, and then a final period of stationary temperature. Interannual variation in temperature is the same at all sites, but mean temperature varies among sites. All sites experienced the same absolute increase in mean temperature. We focused on the biomass dynamics of one focal species that dominated the central site during the baseline period.

During the baseline period there were strong spatial patterns across the mean temperature gradient. 
Individual species, including our focal species, showed classic, unimodal ``Whittaker" patterns of abundances across the gradient (Fig. \ref{fig:species-patterns-models}A).
These spatial patterns are the basis for our ``spatial model" of the temperature-biomass relationship for our focal species (Fig. \ref{fig:species-patterns-models}A). 
In contrast to the strong spatial patterns, population and community responses to interannual variation in temperature within sites were weak.
At our focal site in the center of the gradient, the biomass of the focal species was quite insensitive to interannnual variation in temperature (Fig. \ref{fig:species-patterns-models}B). Our ``temporal model" estimates this weak, linear temperature effect, along with strong lag effects of biomass in the previous year. 

\begin{figure}[tbp]
\centering
\includegraphics[width=1 \textwidth] {species_patterns_models.png}
\caption{(A) Mean biomass by species (colors) across the temperature gradient during the baseline period. The focal species, dominant at the site in the center of the gradient (vertical gray line), is shown in dark blue. The dashed blue line shows predictions from the spatial model. (B) Annual biomass of the focal species at the central site during the baseline period. The dashed line shows predictions from the temporal model. }
\label{fig:species-patterns-models}
\end{figure}

We forecast the effect of a temperature increase (Fig. \ref{fig:community-forecast-species}A) on the focal species' biomass at one location in the center of the temperature gradient 
using both the spatial model and the temporal model. 
The predictions from the spatial and temporal models contrasted markedly, with the temporal 
model predicting a large increase in biomass and the spatial model predicting a decrease. Initially, the simulated abundances followed the increase predicted by the 
temporal model, but as faster-growing species colonized and increased in abundance at the focal site, the biomass of the focal species decreased, eventually falling below its baseline level (Fig. \ref{fig:community-forecast-species}B). 

To combine the spatial and temporal model into a single forecast, we fit a weighting parameter, $\omega$, which varies over time and is bounded between 0 and 1. At any time point, $t$, the combined population forecast is $\omega \cdot T(N_{t-1},K_t) + (1-\omega) \cdot S(K_t) $ where $T$ is the temporal model, which depends on population size, $N$, and expected temperature, $K$, and $S$ is the spatial model, which depends only on $K$ (see Appendix \ref{models} for full description of the approach).
This combined model accurately predicts the simulated dynamics across the full forecast horizon (Fig. \ref{fig:community-forecast-species}B), but 
the reason it works so well is that the weights were determined by fitting directly to the data. Unlike our spatial and temporal model forecasts, 
we did not generate out-of-sample predictions from the combined model; it merely provides 
a convenient way to quantify how rapidly dynamics shift from being dominated by interannual 
variation captured in the temporal model (time $t=0$ to $t \approx 1250$ in Fig. \ref{fig:community-forecast-species}B) to being dominated by the steady-state equilibrium captured by the spatial model (time $t \geq 2500$).
A true, combined forecast would require a method to determine the model weights \emph{a priori}.
The most rapid shifts in the model weights occurred during the period when warm-adapted, faster growing species were increasing most rapidly
in abundance (Fig. \ref{fig:community-forecast-species}C).

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_forecast_species.png}
\caption{(A) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts, at the focal site. (B) Simulated focal species biomass and forecasts from the spatial, temporal and combined models at the focal site in the metacommunity model. (C) Simulated changes in biomass of the focal species (black) and all other species (grey), and the weight given to the temporal model for focal species biomass (blue). Year 1000 in each panel corresponds to the start of the temperature increase. }
\label{fig:community-forecast-species}
\end{figure}


The compositional turnover affecting our focal species also influences total biomass, linking community and ecosystem dynamics. We repeated our focal species analysis for total community biomass, and the results were similar: the temporal model initially made the best forecasts immediately following the onset of the temperature increase, but as the identity and abundances of species at the study site changed, the model weights rapidly shifted to the spatial model (Figs. \ref{fig:community-models-total} and \ref{fig:community-forecasts-total}). 

\section*{Eco-evolutionary example}

Evolutionary adaptation is a key uncertainty in predicting how environmental change will impact a focal population at a given location \citep{Hoffmann2011}. Like the shifts
in species composition illustrated in the previous example, shifts in genotype frequencies can also influence dynamics and forecasts at different time scales.
We demonstrate this process with a hypothetical annual plant population in which fecundity is temperature dependent, and different genotypes have different temperature optima (Fig. \ref{fig:evo_evo_spatial_temporal_models}A). Our model describes how the local density of each genotype changes between years,  which depends on temperature and genotype densities in the previous year. Transient temporal dynamics are computed directly from the model; these dynamics define our temporal forecast. To create ``spatial data'', we simulated the equilibrium density of each genotype under different mean temperatures. The pattern of equilibrium densities across a gradient in mean annual temperature defines our spatial forecast: cold sites will be dominated by the cold-adapted homozygous genotype, warm sites will be dominated by the heat-adapted homozygous genotype, and intermediate sites will be dominated by the heterozygous genotype (Fig. \ref{fig:evo_evo_spatial_temporal_models}B). The full model description is provided in Appendix \ref{eco-evo}. 

\begin{figure}[tbp]
\centering
\includegraphics[width=0.4 \textwidth]{spatial&temporal_model.png}
\caption{(A) Reaction norms of the three genotypes. (B) The spatial pattern of individual genotypes (colors) and total population abundance (black) at sites arrayed across a gradient of mean annual temperature. The dashed line shows predictions from an empirical ``spatial model," a linear regression that describes mean population size as a function of mean temperature. (C) The relationship between annual temperature and per capita growth rate at a location with a mean temperature that favors the cold-adapted genotype. Colors show population size (the blue to red gradient depicting high to low population density), which influences the population growth rate through density dependence. }
\label{fig:evo_evo_spatial_temporal_models}
\end{figure}

The spatial pattern shown in Fig. \ref{fig:evo_evo_spatial_temporal_models}B is the outcome of steady-state conditions. But at any one site, the population's short-term response to temperature will be determined by the dominant genotype's reaction norm (Fig. \ref{fig:evo_evo_spatial_temporal_models}A). For example, at a cold site dominated by the cold-adapted homozygous genotype, a warmer than average year would cause a decrease in population size due to decreases in fecundity (blue line in Fig. \ref{fig:evo_evo_spatial_temporal_models}A), even though the heat-adapted homozygote might perform optimally at that temperature. However, if warmer than normal conditions persist for many years, then genotype frequencies should shift, and the heat-adapted homozygote will compensate for the decreases of the cold-adapted genotype. 

To demonstrate these dynamics, we simulated a diploid annual plant population at a colder than average site. During the baseline period, the population is dominated by the cold-adapted genotype. We used the simulated data from this baseline period to fit an empirical model that assumes no knowledge of the underlying eco-evolutionary process. This empirical temporal model (Appendix \ref{models}) predicts population growth rate as a function of annual temperature and population size (Fig. \ref{fig:evo_evo_spatial_temporal_models}C). We then imposed a period of warming, followed by a final period of higher stationary temperature (Fig. \ref{fig:forecast} top).

With the onset of warming, the population crashed as the cold-adapted genotype decreased in abundance. Eventually, frequencies of the heterozygous genotype and the warm-adapted homozygous genotype began to increase and the population recovered (Fig. \ref{fig:forecast} bottom). The temporal model (solid blue line in Fig. \ref{fig:forecast}) accurately predicted the impact of the initial warming trend, but eventually became too pessimistic, while the spatial model (solid red line in Fig. \ref{fig:forecast}) did not handle the initial trend but accurately predicted the eventual, new steady state (Fig. \ref{fig:forecast} bottom).

As in the community turnover example, we also fit a combined model as a weighted average of the spatial and temporal model, with the weights changing over time. The combined model initially reflected the temporal model (decrease from $t=500$ to $t=600$), but then rapidly transitioned to reflect the spatial model ($t \geq 700$). The rapid transition in the weighting term, $\omega$, occurred during the period of most rapid change in genotype frequencies (Fig. \ref{fig:forecast_supp}). The combined model's predictions look impressively accurate, but, as in the community turnover example, that is because we used the full, simulated time series to fit the weighting term. To generate a true forecast from the combined model, we would need an independent method to predict how the model weights shift over time.

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast.png}
\caption{(Top) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts. (Bottom) Simulated population size and forecasts from the spatial, temporal and combined models.  }
\label{fig:forecast}
\end{figure}

\subsection*{Discussion}

Ecological forecasts are typically made using either a space-for-time substitution approach based on models fit to spatial data or using dynamic models fit to time-series data. Our results demonstrate that these two approaches can make very different predictions about the future state of ecological systems. Which approach provides the most accurate forecasts depends on the forecast-horizon. In our simulations, time-series approaches performed best for short-term forecasts, whereas models based on spatial data made more accurate long-term forecasts. 

The change in model performance with increasing forecast horizon reflects differences in the types and scales of processes captured by spatial and temporal data sets. Local time-series data capture demographic processes, lagged effects, and responses of current assemblages to small changes in environmental conditions. In addition, the state of the system in the near future depends heavily on the current state. Since short-term forecasts do not typically require extrapolating into novel conditions, a model based on the historical range of variation which incorporates lags and accurate initial conditions is likely to be the most generally useful approach for forecasting. The hypothesis that time-series models will be most effective for near-term forecasts is supported by recent empirical analyses of biodiversity forecasts at time scales from one to ten years \citep{harris_forecasting_2018}. In contrast, datasets spanning spatial gradients capture the long-term outcome of interactions between fast processes and slower processes such as ecological and evolutionary selection, dispersal, and responses to large changes in the environment. Models based on data from spatial gradients may be a better choice for predicting long-term, steady-state outcomes of ecological change.

The challenge is determining what is ``near-term'' and what is ``long-term,'' and how to handle the many forecasts we need in ecology which fall in between. Our simulations demonstrate extended transitional periods during which neither the time-series or the spatial approach is effective on its own, but a weighted combination of the two can produce highly accurate predictions. Unfortunately, we currently have no way to determine how to weight these two approaches for different time horizons. Our combined models used weights fitted directly to the simulated data, which is impossible to do for actual forecasting when the future is unknown. We need new theory or empirical case studies in order to assign these weights \emph{a priori}. 

Theory could explore the influence of different parameters on the rate at which slow processes begin to influence dynamics. The effects of some parameters are intuitive: in the community turnover example, increasing the fraction of dispersing individuals caused a more rapid shift in species composition and in model weights (Fig. \ref{fig:dispersal_niche_width}A). Other parameters have less intuitive effects: we expected that increasing the temperature tolerance of genotypes in the evo-evolutionary example would accelerate the shift in model weights by maintaining higher genetic diversity. Our simulations showed the opposite effect, with wider tolerances slowing the shift in model weights, presumably by decreasing the strength of selection. Additional factors to consider include organism lifespans and the magnitude of directional environmental change relative to historical interannual variation. 

Empirical research could address this challenge by accumulating enough case studies to infer patterns in the weighting functions and guide applications in new systems. Developing  rules of thumb would require testing many forecasts from both time-series and spatial models across a range of time-horizons. This effort may require a novel integration of typically disparate approaches, such as analyses of paleoecological data (e.g., \citealt{Worth2014}), long-term observational (e.g., \citealt{Nice2019}) or experimental data (e.g., \citealt{Silvertown2006}), and model systems with short-generation times (e.g., \citealt{Good2017}).

\begin{figure}[tbp]
	\centering
	\includegraphics[width=0.7 \textwidth] {dispersal_niche_width.png}
	\caption{The rate of change in the weight of the temporal forecast (y-axis) depends on (A) the fraction of propagules dispersing in the community turnover example and (B) on the temperature tolerance of genotypes, given by $\sigma_T$ (larger values indicate wider thermal niches) in the eco-evolutionary example. Year 0 in these figures corresponds to the start of the temperature increase. }
	\label{fig:dispersal_niche_width}
\end{figure}

An alternative to a weighted combination of predictions from time-series and space-for-time models is to rely on fully process-based models. If we could accurately characterize all of the processes governing a system, then a model based on that understanding should make accurate predictions at all time-horizons. For example, rather than fitting phenomenological models to our simulated time-series, we could have fit the exact process-based models that we used to generate those time-series. Assuming reasonable estimates of the parameter, those models would have accurately predicted the dynamics at all forecast horizons. Process-based models should also be more robust for making predictions outside of historically observed conditions and even beyond the conditions observed across spatial gradients, which will be especially important for making predictions in a future with increasingly novel combinations of environment and species interactions \citep{Williams2007}. Unfortunately, in most cases this approach is not currently feasible because we lack a detailed knowledge of all the complex and interacting processes influencing the dynamics of real ecological systems. Even if the general form of the models was known, estimating the high number of parameters and quantifying how they vary across ecosystems typically requires more data than is currently available even for well studied systems. As a result, models used for ecological forecasting will include at least some phenomenological components. But that does not mean that phenomenological forecast models do not benefit from process-based understanding. The message from our simulations is that different processes should be considered for different forecast time-scales, and this can be done by fitting models to different kinds of datasets. Even when process-level understanding does not enable a fully mechanistic model, it can improve the specification of phenomenological models.

Another potential approach for intermediate scale forecast horizons is to use models that incorporate both spatial and temporal information simultaneously. Spatiotemporal modeling approaches are being developed to study patterns and processes of interest to ecological forecasters, such the spread of an invasive species or population status of a threatened species  \citep{Wikle2003,Williams2017,Schliep2018}. Because these models include both fast processes, such as births and deaths, and slower processes, such as colonization and extinction dynamics, they have the potential to make better predictions at intermediate forecast horizons than purely spatial or temporal models. However, these spatiotemporal models have rarely been used in a forecasting context, due to a combination of data limitation and computational challenges. Many data sources contain either spatial or temporal variation, but not both, and when spatiotemporal datasets are available they often involve irregular sampling, creating challenges for modeling. Fitting and generating predictions from spatiotemporal models is also computationally intensive, especially with large datasets \citep{McDermott2017}. Fortunately, thanks to large-scale monitoring efforts from remote sensing platforms, the National Ecological Observatory Network (https://www.neonscience.org/), and community science projects (e.g., eBird), large scale spatiotemporal data is increasingly available. In addition, new methods for spatiotemporal forecasting are being developed that address existing computational challenges \citep{McDermott2017}, and access to high performance computing resources is increasingly common. Given these developments, future ecological forecasting efforts should explore spatiotemporal approaches and assess whether they improve predictions at intermediate time scales relative to traditional spatial or temporal models.

Our results have important implications for the emerging field of ecological forecasting. First, they suggest that evaluating both near-term and long-term
forecasts will be essential as research on forecasting methods accelerates. Second, while single approaches may perform reasonably well at either short or long forecast horizons, skillful predictions at intermediate time horizons may require a combination of information from spatial and temporal patterns. Intermediate time horizons pose challenges in other forecasting contexts as well. Weather forecasts based on regional-scale meteorological models are very effective for forecasting a week to ten days in advance, but then become largely uninformative. Forecasting these intermediate scales has been challenging in meteorology and will likely be challenging in ecology as well. While the recent emphasis on near-term iterative forecasting \citep{dietze_iterative_2018} is the logical and tractable starting point, we also need to build understanding and capacity for forecasting ecological dynamics across all temporal scales of interest.

\subsubsection*{Acknowledgements}

We thank Heather Lynch and Juan Manuel Morales for comments that improved early drafts of the paper. PBA was supported by NSF DEB-1927282 and the Utah Agriculture Experiment Station, EPW was supported by ??, and MHC was supported by ??.

\newpage
\renewcommand{\refname}{Literature cited}
\bibliographystyle{Ecology}
\bibliography{references}


%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% APPENDICES !
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\clearpage 
\newpage 

\setcounter{page}{1}
\setcounter{equation}{0}
\setcounter{figure}{0}
\setcounter{section}{0}
\setcounter{table}{0}

\centerline{\Large \textbf{Appendices}}

\renewcommand{\thesection}{\Alph{section}}

\section{Spatial, temporal and combined models}\label{models}

The two simulation models in the main text describe how population size, $N(x,t)$, at location $x$ changes over time ($t$). We assume that the temperature, $K(x,t)$, at each location can vary in time and space.    

The spatial model, which we refer to as $S$, is a quadratic regression of the mean long-term population density at a location ($\bar{N}(x)$) against the mean temperature at that location ($\bar{K}(x)$).  The quadratic term describes the unimodal relationship between $\bar{N}$ and $\bar{K}$. The spatial statistical model is
\begin{equation}
\bar{N}(x) = S(\bar{K}(x)) = \beta^S_0 +  \beta^S_1 \bar{K}(x) +\beta^S_2 {\bar{K}(x)}^2 + \varepsilon
\label{eqn:spatial_regression}
\end{equation}

The temporal model, which we call $T$, starts with a time-series of ``observed" population sizes, or total biomasses, at one location, $N(t)$, for $t=1...n$ (the spatial index is suppressed because we only focus on one location at a time). In the community turnover example, we fit the following regression, which predicts biomass at time $t+1$ as a function of biomass ($N(t)$) and annual temperature ($K(t)$) at time $t$,
\begin{equation}
\ln(N(t+1)) = T(N(t),K(t)) = \beta^T_0 +  \beta^T_1 \ln(N(t)) +\beta^T_2 K(t)  +  \varepsilon
\label{eqn:temporal_regression_community1}
\end{equation}
In the eco-evolutionary example, the response variable is the log of the population growth rate. The regression is 
\begin{equation}
\ln\left(\frac{N(t+1)}{N(t)}\right) = T(N(t),K(t)) = \beta^T_0 +  \beta^T_1 \ln(N(t)) +\beta^T_2 K(t)  +\beta^T_3 K(t)^2 +  \varepsilon
\label{eqn:temporal_regression_ecoevo2}
\end{equation}
This version of the temporal model returns a per capita growth rate on the log scale. To predict population size at the next time step, we exponentiate the growth rate and multiply it by the current population size: $\exp(T(N(t),K(t))) N(t)$.

The combined model is a weighted average of predictions from the spatial and temporal models, with the weights changing as a function of time, here expressed as the forecast horizon. The weights change as a function of the square root of the forecast horizon, to allow rapid shifts in the model weights. 
\begin{equation}
logit(\omega_t)=\beta^C_0 + \beta^C_1 \sqrt{t}
\label{eqn:weights}
\end{equation}
For the community turnover example, the predicted biomass from the combined model is:
\begin{equation}
\hat{N}(t+1)= \omega \cdot T(N(t),K(t)) + (1-\omega) \cdot S(K(t)) 
\label{eqn:combined_model1}
\end{equation}
Again, we suppress the spatial subscript ($x$) here because we are focused on densities at just one location. For the eco-evolutionary example, the predicted population size from the combined model is:
\begin{equation}
\hat{N}(t+1) = \omega \cdot \exp(T(N(t),K(t))) N(t) + (1-\omega) \cdot S(K(t)) 
\label{eqn:combined_model2}
\end{equation}

We used the \texttt{optim} function to estimate the $\beta^C$s that minimize the sum of squared errors, $(\hat{N}(t+1) - N(t+1))^2$.

\section{Description of the meta-community model}\label{metacomm}

\cite{alexander_lags_2018} developed a meta-community model to represent dynamics of local communities arrayed along a one-dimensional elevation gradient, as influenced by three main processes: temperature-dependent growth, competition, and dispersal. Here we adapt their notation to be consistent our own.

The population size of species $i$ in cell $x$ at time $t + 1$, $N_{i}(x,t+1)$, is computed in two steps. The first step accounts for changes in local population sizes due to dispersal. In each local community, all species export a fraction ($d$) of their local population to the two adjacent communities in the 1-dimensional landscape:
\begin{equation}
N'_{i}(x,t) = (1-d) \cdot N_{i}(x,t) + \frac{d}{2} \cdot (N_{i}(x+1,t) + N_{i}(x-1,t))
\end{equation}
Here $N'$ distinguishes the post-dispersal population size from the pre-dispersal population size.

The second step computes population growth, taking into account competition:
\begin{equation}
N_{i}(x,t+1) = N'_{i}(x,t) + N'_{i}(x,t)[g_i(K(x) - Kmin_i) - c_i N'_{i}(x,t) - l_i \sum_{k} N'_{k}(x,t)]
\end{equation}
In the absence of competition, the growth rate ($g_i$) is determined by the difference between the temperature at site $x$ ($K(x)$) and the focal species' minimum temperature tolerance, $Kmin_i$, the lowest temperature at which a species can maintain a positive growth rate. Growth is further reduced by intraspecific and interspecific competition, parameterized by $c_i$ and $l_i$.  All species are assigned the same value of $c_i$, which represents an additional effect of intraspecific competition on top of interspecific competition. This stabilizes coexistence, since every species will exert stronger intra- than interspecific competition. However, values of $l$ vary among species to create a trade-off between growth rates and competitive ability versus low temperature tolerance: fast-growing species (high $g_i$) are more tolerant of interspecific competition (low $l_i$) but are more limited by temperature (high $Kmin_i$).

\section{Description of the eco-evolutionary annual plant model}\label{eco-evo}

%\renewcommand{\theequation}{B-\arabic{equation}}
%\renewcommand{\thetable}{B-\arabic{table}}
%\renewcommand{\thefigure}{B-\arabic{figure}}

\noindent \textbf{Haploid Model:} Begin with a haploid model that describes the number of seeds present in a seed bank.  $N_{i,t}$ is the number of seeds of species $i$ at time $t$.  The model is
\begin{align}\begin{split}
N_{1,t+1} &= s_1 [1-g_1(K(t))]N_{1,t}+\frac{\lambda_1g_1(K(t))N_{1,t}}{1+ \alpha_{11}g_1(K(t))N_{1,t} + \alpha_{12}g_2(K(t))N_{2,t}}\\
N_{2,t+1} &= s_2 [1-g_2(K(t))]N_{2,t}+\frac{\lambda_2g_2(K(t))N_{2,t}}{1+ \alpha_{21}g_1(K(t))N_{1,t} + \alpha_{22}g_2(K(t))N_{2,t}}
\end{split}\end{align}
where $g_{i}(K(t))$ is the probability of germination, $K(t)$ is the temperature at time $t$, $s_i$ is the seed survival probability for species $i$, and $\lambda_i$ is the seed production rate per plant.  Below we refer to the $\alpha_{ij}$ as intra- and inter-specific competition coefficients.  

\noindent \textbf{Diploid Model:} Consider a one-species diploid model.  The genotypes are denoted by $AA$, $Aa$, and $aa$.   The number of each genotypes at time $t$ is $N_{AA}(t)$, $N_{Aa}(t)$, and $N_{aa}(t)$.  The germination rates for each genotype are $g_{AA}(K(t))$, $g_{Aa}(K(t))$, and $g_{aa}(K(t))$.  The seed survival probability and seed production rate for genotype $AA$ are $s_{AA}$ and $\lambda_{AA}$, respectively.  The analogous parameters for the other genotypes are similarly denoted.  The competition coefficients are denoted by $\alpha_{i,j}$, e.g., $\alpha_{AA,AA}$ or $\alpha_{AA,Aa}$.  Throughout we assume that gametes mix randomly in the population.  

First consider the case where the competition coefficients are zero ($\alpha_{i,j}=0$).  Let $T$ denote the total number of gamete-pairs produced in a given year,
\begin{equation}
T = \lambda_{AA}N_{AA}(t)g_{AA}(K(t))+ \lambda_{Aa}N_{Aa}(t)g_{Aa}(K(t))+\lambda_{aa}N_{aa}(t)g_{aa}(K(t)).
\end{equation}
The first term is the number of gamete-pairs produced by $AA$ individuals.  The second and third terms are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportion of $A$ gametes ($\phi_A$) and the proportion of $a$ gametes ($\phi_a$) are given by
\begin{align}\begin{split}
\phi_{A} &= \frac{\lambda_{AA}N_{AA}(t)g_{AA}(K(t))+ \frac{1}{2}\lambda_{Aa}N_{Aa}(t)g_{Aa}(K(t))}{T} \hspace{10pt} \text{and} \hspace{10pt} \phi_a = 1-\phi_{A}.
\end{split}\end{align}
Note that the $T$ in the denominator of $\phi_A$ shows up because we are computing proportions.  Combining all of these we get the dynamics for each genotype,
\begin{align}\begin{split}
N_{AA}(t+1) &= s_{AA}[1-g_{AA}(K(t))]N_{AA}(t) + \phi_A^2T\\
N_{Aa}(t+1) &= s_{Aa}[1-g_{Aa}(K(t))]N_{Aa}(t) + \phi_A\phi_aT\\
N_{aa}(t+1) &= s_{aa}[1-g_{aa}(K(t))]N_{aa}(t) + \phi_a^2T
\end{split}\end{align}

Now consider the case where the competition coefficients are non-zero ($\alpha_{i,j}\neq0$).  Including competition changes the way in which we compute $T$, $\phi_A$, and $\phi_a$.  Specifically, because the total number of seeds produced per year by each genotypes is reduced based on intra- and inter-specific competition, the total number of gamete-pairs becomes
\begin{align}\begin{split}
T &=  \frac{\lambda_{AA}N_{AA}(t)g_{AA}(K(t))}{1+ \alpha_{AA,AA}g_{AA}(K(t))N_{AA}(t) + \alpha_{AA,Aa}g_{Aa}(K(t))N_{Aa}(t)+ \alpha_{AA,aa}g_{aa}(K(t))N_{aa}(t)} \\ 
&+ \frac{\lambda_{Aa}N_{Aa}(t)g_{Aa}(K(t))}{1+ \alpha_{Aa,AA}g_{AA}(K(t))N_{AA}(t) + \alpha_{Aa,Aa}g_{Aa}(K(t))N_{Aa}(t)+ \alpha_{Aa,aa}g_{aa}(K(t))N_{aa}(t)}\\
&+\frac{\lambda_{aa}N_{aa}(t)g_{aa}(K(t))}{1+ \alpha_{aa,AA}g_{AA}(K(t))N_{AA}(t) + \alpha_{aa,Aa}g_{Aa}(K(t))N_{Aa}(t)+ \alpha_{aa,aa}g_{aa}(K(t))N_{aa}(t)}.
\label{eqn:defineT}
\end{split}\end{align}
The first line is the number of gamete-pairs produced by $AA$ individuals after accounting for the effects of competition.  The second and third lines are the numbers of gamete-pairs produced by $Aa$ and $aa$ individuals, respectively. The proportions of $A$ gametes and $a$ gametes are 
\begin{align}\begin{split}
\phi_A &= \frac{1}{T}\frac{\lambda_{AA}N_{AA}(t)g_{AA}(K(t))}{1+ \alpha_{AA,AA}g_{AA}(K(t))N_{AA}(t) + \alpha_{AA,Aa}g_{Aa}(K(t))N_{Aa}(t)+ \alpha_{AA,aa}g_{aa}(K(t))N_{aa}(t)} \\
&+ \frac{1}{2T}\frac{\lambda_{Aa}N_{Aa}(t)g_{Aa}(K(t))}{1+ \alpha_{Aa,AA}g_{AA}(K(t))N_{AA}(t) + \alpha_{Aa,Aa}g_{Aa}(K(t))N_{Aa}(t)+ \alpha_{Aa,aa}g_{aa}(K(t))N_{aa}(t)}\\
\phi_a &= 1- \phi_A
\label{eqn:definePhi}
\end{split}\end{align}
Combining all of this results in the same model as above,
\begin{align}\begin{split}
N_{AA}(t+1) &= s_{AA}[1-g_{AA}(K(t))]N_{AA}(t) + \phi_A^2T\\
N_{Aa}(t+1) &= s_{Aa}[1-g_{Aa}(K(t))]N_{Aa}(t) + 2 \phi_A\phi_aT\\
N_{aa}(t+1) &= s_{aa}[1-g_{aa}(K(t))]N_{aa}(t) + \phi_a^2T,
\end{split}\end{align}
but the definitions of $T$, $\phi_A$, and $\phi_a$ are given by equations (\ref{eqn:defineT}) and (\ref{eqn:definePhi}) . 

\newpage 

\section{Supplementary Figures}

\renewcommand{\thefigure}{S-\arabic{figure}}

\begin{figure}[!ht]
\centering
\includegraphics[width=0.7 \textwidth] {community_models_total.png}
\caption{(Results for total biomass from the community turnover model. Blue points show mean total biomass during the baseline period at locations across the temperature gradient, and the blue line shows predictions from the spatial model. Red points show annual total biomass during the baseline period as a function of annual temperature at the central site on the gradient. The red line shows predictions from the temporal model.   }
\label{fig:community-models-total}
\end{figure}

\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {community_forecast_total.png}
\caption{Results for total biomass from the community turnover model. (A) Simulated annual temperatures (grey) and expected temperature (black), which was used to make forecasts, at the focal site. (B) Simulated total biomass and forecasts from the spatial, temporal and combined models. (C) Simulated changes in biomass of all species (grey) at the focal site in the metacommunity model, and the weight given to the temporal model for total biomass (blue). Year 1000 in this figure corresponds to the start of the temperature increase.  }
\label{fig:community-forecasts-total}
\end{figure}


\begin{figure}[tbp]
\centering
\includegraphics[width=0.7 \textwidth] {forecast_supplement.png}
\caption{Simulated shifts in genotype abundances, and the model weighting term, $\omega$, during the warming phase and the following stationary temperature phase. Year 0 in this figure corresponds to the start of the temperature increase.}
\label{fig:forecast_supp}
\end{figure}


\end{document}

